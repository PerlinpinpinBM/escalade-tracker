<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Escalade v5.1</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,sans-serif;background:linear-gradient(135deg,#1e293b,#0f172a);color:#fff;min-height:100vh;padding:20px}
.container{max-width:500px;margin:0 auto}
.login{display:flex;align-items:center;justify-content:center;min-height:100vh}
.login-card{background:#1e293b;padding:40px;border-radius:16px;width:100%;max-width:400px;text-align:center}
.login-card h1{font-size:2rem;margin-bottom:30px}
.form-group{margin-bottom:20px;text-align:left}
.form-group label{display:block;color:#94a3b8;margin-bottom:8px;font-size:0.9rem}
.form-group input{width:100%;padding:12px;border:1px solid #475569;border-radius:8px;background:#0f172a;color:#fff;font-size:1rem}
.btn{width:100%;padding:14px;border:none;border-radius:8px;font-size:1rem;cursor:pointer;transition:all 0.3s}
.btn-primary{background:#10b981;color:#fff}
.btn-primary:active{background:#059669}
.error{background:#7f1d1d;color:#fca5a5;padding:12px;border-radius:8px;margin-bottom:20px;font-size:0.9rem}
.hidden{display:none!important}
.header{text-align:center;margin-bottom:30px}
.header h1{font-size:1.8rem;margin-bottom:5px}
.header .version{color:#94a3b8;font-size:0.8rem}
.nav{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:30px}
.nav-btn{padding:20px;background:#1e293b;border:2px solid #334155;border-radius:12px;text-align:center;cursor:pointer;transition:all 0.3s}
.nav-btn:active{background:#334155}
.nav-btn .icon{font-size:2rem;margin-bottom:8px}
.nav-btn .label{font-size:1rem}
.card{background:#1e293b;padding:20px;border-radius:12px;margin-bottom:20px;border:1px solid #334155}
.card h2{font-size:1.2rem;margin-bottom:15px;display:flex;justify-content:space-between;align-items:center}
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px}
.stat{background:#334155;padding:15px;border-radius:8px;text-align:center}
.stat-label{color:#94a3b8;font-size:0.8rem;margin-bottom:5px}
.stat-value{font-size:1.5rem;font-weight:bold;color:#10b981}
.weather-card{background:#334155;padding:15px;border-radius:8px;margin-bottom:10px}
.weather-card h3{font-size:1rem;margin-bottom:10px}
.weather-days{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.weather-day{background:#1e293b;padding:10px;border-radius:6px;text-align:center}
.weather-day .day-name{color:#94a3b8;font-size:0.8rem;margin-bottom:5px}
.weather-day .icon{font-size:1.5rem;margin:5px 0}
.weather-day .temp{font-size:0.9rem}
.session-type{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px}
.type-card{background:#334155;padding:30px 20px;border-radius:12px;text-align:center;cursor:pointer;transition:all 0.3s}
.type-card:active{background:#475569}
.type-card .icon{font-size:3rem;margin-bottom:10px}
.type-card .label{font-size:1.1rem}
.voie-item{background:#334155;padding:15px;border-radius:8px;margin-bottom:10px}
.voie-item h4{margin-bottom:8px;font-size:1rem}
.voie-details{color:#94a3b8;font-size:0.85rem;margin-bottom:8px}
.voie-actions{display:flex;gap:8px}
.btn-small{padding:8px 12px;font-size:0.85rem;border:none;border-radius:6px;cursor:pointer}
.btn-danger{background:#ef4444;color:#fff}
.btn-edit{background:#3b82f6;color:#fff}
.btn-add{background:#10b981;color:#fff;width:100%;padding:12px;margin-top:10px}
.back-btn{background:#475569;color:#fff;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;margin-bottom:20px}
.input{width:100%;padding:10px;border:1px solid #475569;border-radius:6px;background:#0f172a;color:#fff;margin-bottom:10px;font-size:0.95rem}
select.input{-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;background-size:20px;padding-right:35px}
.badge{display:inline-block;padding:4px 8px;border-radius:4px;font-size:0.75rem;font-weight:600;margin-left:8px}
.badge-projet{background:#fbbf24;color:#000}
.badge-r√©ussi{background:#10b981;color:#fff}
.badge-abandon{background:#ef4444;color:#fff}
.stars{font-size:2.5rem;margin:15px 0;cursor:pointer;user-select:none;display:flex;gap:15px;justify-content:center}.star{display:inline-block;padding:10px;cursor:pointer;touch-action:manipulation}
.star.filled{color:#fbbf24}
.star.empty{color:#475569}
.history-item{background:#334155;padding:12px;border-radius:8px;margin-bottom:8px;cursor:pointer;transition:all 0.3s}
.history-item:active{background:#475569}
.history-item h4{font-size:0.95rem;margin-bottom:4px}
.history-item .details{color:#94a3b8;font-size:0.8rem}
.divider{border-top:2px solid #334155;margin:25px 0;padding-top:10px}
.divider h3{color:#94a3b8;font-size:1rem;margin-bottom:15px}
.delete-session-btn{background:#ef4444;color:#fff;width:100%;padding:12px;margin-top:10px;border:none;border-radius:8px;cursor:pointer}
</style>
</head>
<body>
<div id="login-screen" class="login">
<div class="login-card">
<h1>üîí Escalade Tracker</h1>
<div id="login-error" class="error hidden"></div>
<div class="form-group">
<label>Utilisateur</label>
<input type="text" id="username" placeholder="Utilisateur">
</div>
<div class="form-group">
<label>Mot de passe</label>
<input type="password" id="password" placeholder="Mot de passe">
</div>
<button class="btn btn-primary" id="login-btn">Connexion</button>
</div>
</div>
<div id="app" class="hidden">
<div class="container">
<div class="header">
<h1>‚õ∞Ô∏è Escalade Tracker</h1>
<div class="version">v5.1</div>
</div>
<div id="home-view">
<div class="nav">
<div class="nav-btn" id="board-nav">
<div class="icon">üìä</div>
<div class="label">Board</div>
</div>
<div class="nav-btn" id="session-nav">
<div class="icon">‚ûï</div>
<div class="label">Session</div>
</div>
</div>
</div>
<div id="board-view" class="hidden">
<button class="back-btn" id="board-back">‚Üê Retour</button>
<div class="card">
<h2>üìä Bruno</h2>
<div class="stat-grid">
<div class="stat"><div class="stat-label">Max 2025</div><div class="stat-value" id="bruno-max">-</div></div>
<div class="stat"><div class="stat-label">Sessions salle</div><div class="stat-value" id="bruno-salle">0</div></div>
<div class="stat"><div class="stat-label">Sessions falaise</div><div class="stat-value" id="bruno-falaise">0</div></div>
</div>
</div>
<div class="card">
<h2>üìä Sophie</h2>
<div class="stat-grid">
<div class="stat"><div class="stat-label">Max 2025</div><div class="stat-value" id="sophie-max">-</div></div>
<div class="stat"><div class="stat-label">Sessions salle</div><div class="stat-value" id="sophie-salle">0</div></div>
<div class="stat"><div class="stat-label">Sessions falaise</div><div class="stat-value" id="sophie-falaise">0</div></div>
</div>
</div>
<div class="card">
<h2>üå§Ô∏è M√©t√©o Week-end</h2>
<div id="weather-container"></div>
</div>
</div>
<div id="session-choice-view" class="hidden">
<button class="back-btn" id="choice-back">‚Üê Retour</button>
<div class="session-type">
<div class="type-card" id="salle-btn">
<div class="icon">üè¢</div>
<div class="label">Salle</div>
</div>
<div class="type-card" id="falaise-btn">
<div class="icon">‚õ∞Ô∏è</div>
<div class="label">Falaise</div>
</div>
</div>
</div>
<div id="session-form-view" class="hidden">
<button class="back-btn" id="form-back">‚Üê Retour</button>
<div class="card">
<h2 id="session-title">Nouvelle Session</h2>
<label>Qui</label>
<select class="input" id="session-user">
<option value="Bruno">Bruno</option>
<option value="Sophie">Sophie</option>
</select>
<label>Nom</label>
<input class="input" id="session-nom" placeholder="Nom du lieu">
<label>Date</label>
<input class="input" type="date" id="session-date">
<button class="btn btn-primary" id="create-session-btn">Continuer</button>
</div>
<div class="divider">
<h3>üìã Historique</h3>
<div id="history-list"></div>
</div>
</div>
<div id="session-voies-view" class="hidden">
<button class="back-btn" id="voies-back">‚Üê Retour</button>
<div class="card">
<h2 id="session-info-title">Session</h2>
<div id="voies-list"></div>
<button class="btn-add" id="add-voie-btn">‚ûï Ajouter une voie</button>
<button class="delete-session-btn" id="delete-session-btn">üóë Supprimer la session</button>
</div>
</div>
<div id="voie-form-view" class="hidden">
<button class="back-btn" id="voie-back">‚Üê Retour</button>
<div class="card">
<h2 id="voie-form-title">Nouvelle Voie</h2>
<input type="hidden" id="voie-edit-id">
<div id="voie-nom-field">
<label>Nom de la voie</label>
<input class="input" id="voie-nom" placeholder="Ex: La Directe">
</div>
<label>Niveau</label>
<select class="input" id="voie-niveau">
<option>5a</option><option>5b</option><option>5c</option>
<option selected>6a</option><option>6a+</option><option>6b</option><option>6b+</option>
<option>6c</option><option>6c+</option><option>7a</option><option>7a+</option>
<option>7b</option><option>7b+</option><option>7c</option><option>7c+</option><option>8a</option>
</select>
<label>Type</label>
<select class="input" id="voie-type">
<option value="copyrock">CopyRock</option>
<option value="dalle">Dalle</option>
<option value="devers">Devers</option>
<option value="gros-devers">Gros Devers</option>
<option value="petit-devers">Petit Devers</option>
<option value="vertical">Vertical</option>
</select>
<label>Statut</label>
<select class="input" id="voie-statut">
<option value="projet">Projet</option>
<option value="r√©ussi">R√©ussi</option>
<option value="abandon">Abandon</option>
</select>
<label>Nombre d'essais</label>
<input class="input" type="number" id="voie-essais" value="1" min="1">
<label>Note (obligatoire)</label>
<div class="stars" id="star-rating"></div>
<input type="hidden" id="voie-rating" value="0">
<label>Notes</label>
<input class="input" id="voie-notes" placeholder="Optionnel">
<button class="btn btn-primary" id="save-voie-btn">‚úì Enregistrer</button>
</div>
</div>
</div>
</div>
<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import{getDatabase,ref,set,onValue,remove}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
const app=initializeApp({apiKey:"AIzaSyDILef-HO__QCnEJwQDNvCELmXXbF3kAfI",authDomain:"escalade-tracker.firebaseapp.com",databaseURL:"https://escalade-tracker-default-rtdb.europe-west1.firebasedatabase.app",projectId:"escalade-tracker",storageBucket:"escalade-tracker.firebasestorage.app",messagingSenderId:"355020489656",appId:"1:355020489656:web:515ba5f926045ff86f054d"});
const db=getDatabase(app);
let sessions=[],currentSession=null,currentType=null,isEditMode=false;
const cotations=["5a","5b","5c","6a","6a+","6b","6b+","6c","6c+","7a","7a+","7b","7b+","7c","7c+","8a"];

function showView(viewId){
document.querySelectorAll('[id$="-view"]').forEach(v=>v.classList.add("hidden"));
document.getElementById(viewId).classList.remove("hidden");
}

function loadData(){
onValue(ref(db,"sessions"),snapshot=>{
const data=snapshot.val();
sessions=data?Object.values(data).map(s=>({...s,voies:s.voies||[]})):[];
updateBoard();
});
}

function updateBoard(){
const year=new Date().getFullYear();
const brunoSessions=sessions.filter(s=>s.user==="Bruno"&&new Date(s.date).getFullYear()===year);
const sophieSessions=sessions.filter(s=>s.user==="Sophie"&&new Date(s.date).getFullYear()===year);
const brunoVoies=brunoSessions.flatMap(s=>s.voies.filter(v=>v.statut==="r√©ussi"));
const sophieVoies=sophieSessions.flatMap(s=>s.voies.filter(v=>v.statut==="r√©ussi"));
const brunoMax=brunoVoies.length>0?brunoVoies.map(v=>v.niveau).sort((a,b)=>cotations.indexOf(b)-cotations.indexOf(a))[0]:"-";
const sophieMax=sophieVoies.length>0?sophieVoies.map(v=>v.niveau).sort((a,b)=>cotations.indexOf(b)-cotations.indexOf(a))[0]:"-";
document.getElementById("bruno-max").textContent=brunoMax;
document.getElementById("bruno-salle").textContent=brunoSessions.filter(s=>s.type==="salle").length;
document.getElementById("bruno-falaise").textContent=brunoSessions.filter(s=>s.type==="falaise").length;
document.getElementById("sophie-max").textContent=sophieMax;
document.getElementById("sophie-salle").textContent=sophieSessions.filter(s=>s.type==="salle").length;
document.getElementById("sophie-falaise").textContent=sophieSessions.filter(s=>s.type==="falaise").length;
}

async function loadWeather(){
const locations=[{name:"Saffres",lat:47.41,lon:4.83},{name:"Cormot",lat:47.13,lon:4.85},{name:"Annecy",lat:45.90,lon:6.13},{name:"Dolada",lat:46.43,lon:11.84}];
const container=document.getElementById("weather-container");
container.innerHTML="<p style='color:#94a3b8'>Chargement...</p>";
try{
const forecasts=await Promise.all(locations.map(loc=>fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${loc.lat}&lon=${loc.lon}&appid=3c97f3998a6c30aa75a296934fc0d3f0&units=metric&lang=fr`).then(r=>r.json()).then(data=>({name:loc.name,data:data}))));
container.innerHTML=forecasts.map(f=>{
if(!f.data||!f.data.list)return`<div class="weather-card"><h3>${f.name}</h3><p style="color:#94a3b8">Erreur API</p></div>`;
const now=new Date();
const day=now.getDay();
const list=f.data.list;
let satData,sunData;
if(day===6){
const todayData=list.filter(d=>{const dt=new Date(d.dt*1000);return dt.getDate()===now.getDate()&&dt.getHours()>=12&&dt.getHours()<=15});
satData=todayData[0]||list[0];
const sunData2=list.filter(d=>new Date(d.dt*1000).getDay()===0&&new Date(d.dt*1000).getHours()>=12&&new Date(d.dt*1000).getHours()<=15);
sunData=sunData2[0]||list.filter(d=>new Date(d.dt*1000).getDay()===0)[0];
}else if(day===0){
const todayData=list.filter(d=>{const dt=new Date(d.dt*1000);return dt.getDate()===now.getDate()&&dt.getHours()>=12&&dt.getHours()<=15});
sunData=todayData[0]||list[0];
const nextSat=list.filter(d=>new Date(d.dt*1000)>now&&new Date(d.dt*1000).getDay()===6);
satData=nextSat[nextSat.length>5?5:Math.floor(nextSat.length/2)]||nextSat[0];
}else{
const nextSat=list.filter(d=>new Date(d.dt*1000).getDay()===6&&new Date(d.dt*1000).getHours()>=12&&new Date(d.dt*1000).getHours()<=15);
const nextSun=list.filter(d=>new Date(d.dt*1000).getDay()===0&&new Date(d.dt*1000).getHours()>=12&&new Date(d.dt*1000).getHours()<=15);
satData=nextSat[0]||list.filter(d=>new Date(d.dt*1000).getDay()===6)[0];
sunData=nextSun[0]||list.filter(d=>new Date(d.dt*1000).getDay()===0)[0];
}
if(!satData||!sunData)return`<div class="weather-card"><h3>${f.name}</h3><p style="color:#94a3b8">Donn√©es incompl√®tes</p></div>`;
const getIcon=code=>code<300?"‚õàÔ∏è":code<600?"üåßÔ∏è":code<700?"üå®Ô∏è":code<800?"üå´Ô∏è":code===800?"‚òÄÔ∏è":"‚òÅÔ∏è";
return`<div class="weather-card"><h3>${f.name}</h3><div class="weather-days"><div class="weather-day"><div class="day-name">Samedi</div><div class="icon">${getIcon(satData.weather[0].id)}</div><div class="temp">${Math.round(satData.main.temp_min)}¬∞/${Math.round(satData.main.temp_max)}¬∞C</div></div><div class="weather-day"><div class="day-name">Dimanche</div><div class="icon">${getIcon(sunData.weather[0].id)}</div><div class="temp">${Math.round(sunData.main.temp_min)}¬∞/${Math.round(sunData.main.temp_max)}¬∞C</div></div></div></div>`;
}).join("");
}catch(e){
console.error(e);
container.innerHTML="<p style='color:#ef4444'>Erreur m√©t√©o : "+e.message+"</p>";
}
}

function renderHistory(){
const list=document.getElementById("history-list");
const filtered=sessions.filter(s=>s.type===currentType).sort((a,b)=>new Date(b.date)-new Date(a.date));
if(filtered.length===0){list.innerHTML='<p style="color:#94a3b8;text-align:center">Aucun historique</p>';return;}
list.innerHTML=filtered.map(s=>`<div class="history-item" data-session-id="${s.id}"><h4>${s.nom} - ${s.date}</h4><div class="details">${s.user} ‚Ä¢ ${s.voies.length} voie(s)</div></div>`).join("");
document.querySelectorAll('.history-item').forEach(el=>{el.addEventListener('click',()=>{const session=sessions.find(s=>s.id==el.dataset.sessionId);currentSession={...session};isEditMode=true;document.getElementById("session-info-title").textContent=session.nom+" - "+session.date;showView("session-voies-view");renderVoies();});});
}

function renderVoies(){
const list=document.getElementById("voies-list");
if(currentSession.voies.length===0){list.innerHTML='<p style="color:#94a3b8;text-align:center;padding:20px">Aucune voie</p>';return;}
list.innerHTML=currentSession.voies.map((v,i)=>{
const title=currentType==="salle"?`Voie ${i+1}`:v.nom;
const stars="‚≠ê".repeat(v.rating||0)+"‚òÜ".repeat(3-(v.rating||0));
return`<div class="voie-item"><h4>${title} <span class="badge badge-${v.statut}">${v.statut}</span></h4><div class="stars">${stars}</div><div class="voie-details">${v.niveau} ‚Ä¢ ${v.type} ‚Ä¢ ${v.essais} essai(s)${v.notes?" ‚Ä¢ "+v.notes:""}</div><div class="voie-actions"><button class="btn-small btn-edit" data-voie-id="${v.id}">‚úèÔ∏è</button><button class="btn-small btn-danger" data-delete-voie="${v.id}">üóë</button></div></div>`;
}).join("");
document.querySelectorAll('[data-voie-id]').forEach(el=>{el.addEventListener('click',()=>{const voie=currentSession.voies.find(v=>v.id==el.dataset.voieId);document.getElementById("voie-form-title").textContent="Modifier";document.getElementById("voie-edit-id").value=voie.id;if(currentType==="falaise"){document.getElementById("voie-nom-field").classList.remove("hidden");document.getElementById("voie-nom").value=voie.nom;}else{document.getElementById("voie-nom-field").classList.add("hidden");}document.getElementById("voie-niveau").value=voie.niveau;document.getElementById("voie-type").value=voie.type;document.getElementById("voie-statut").value=voie.statut;document.getElementById("voie-essais").value=voie.essais;document.getElementById("voie-rating").value=voie.rating||0;document.getElementById("voie-notes").value=voie.notes;updateStarDisplay(voie.rating||0);showView("voie-form-view");});});
document.querySelectorAll('[data-delete-voie]').forEach(el=>{el.addEventListener('click',()=>{if(confirm("Supprimer ?")){currentSession.voies=currentSession.voies.filter(v=>v.id!=el.dataset.deleteVoie);renderVoies();}});});
}

function updateStarDisplay(rating){
const container=document.getElementById("star-rating");
container.innerHTML='';
for(let i=1;i<=3;i++){
const star=document.createElement('span');
star.className='star '+(i<=rating?'filled':'empty');
star.textContent='‚≠ê';
star.addEventListener('click',()=>{document.getElementById("voie-rating").value=i;updateStarDisplay(i);});
container.appendChild(star);
}
}

window.addEventListener('DOMContentLoaded',()=>{
document.getElementById("login-btn").addEventListener('click',()=>{
const u=document.getElementById("username").value;
const p=document.getElementById("password").value;
if(u==="michel"&&p==="MichMich#2026"){
localStorage.setItem("escalade-user","michel");
showView("app");
document.getElementById("login-screen").classList.add("hidden");
document.getElementById("home-view").classList.remove("hidden");
loadData();
}else{
document.getElementById("login-error").textContent="Identifiants incorrects";
document.getElementById("login-error").classList.remove("hidden");
}
});
document.getElementById("board-nav").addEventListener('click',()=>{showView("board-view");updateBoard();loadWeather();});
document.getElementById("session-nav").addEventListener('click',()=>showView("session-choice-view"));
document.getElementById("board-back").addEventListener('click',()=>showView("home-view"));
document.getElementById("choice-back").addEventListener('click',()=>showView("home-view"));
document.getElementById("salle-btn").addEventListener('click',()=>{currentType="salle";isEditMode=false;document.getElementById("session-title").textContent="Nouvelle Session üè¢";document.getElementById("session-nom").value="Nautil";document.getElementById("session-date").value=new Date().toISOString().split("T")[0];showView("session-form-view");renderHistory();});
document.getElementById("falaise-btn").addEventListener('click',()=>{currentType="falaise";isEditMode=false;document.getElementById("session-title").textContent="Nouvelle Session ‚õ∞Ô∏è";document.getElementById("session-nom").value="";document.getElementById("session-date").value=new Date().toISOString().split("T")[0];showView("session-form-view");renderHistory();});
document.getElementById("form-back").addEventListener('click',()=>showView("session-choice-view"));
document.getElementById("create-session-btn").addEventListener('click',()=>{const user=document.getElementById("session-user").value;const nom=document.getElementById("session-nom").value;const date=document.getElementById("session-date").value;if(!nom||!date){alert("Remplis tous");return;}currentSession={id:Date.now(),type:currentType,user:user,nom:nom,date:date,voies:[]};isEditMode=false;document.getElementById("session-info-title").textContent=nom+" - "+date;showView("session-voies-view");renderVoies();});
document.getElementById("add-voie-btn").addEventListener('click',()=>{document.getElementById("voie-form-title").textContent="Nouvelle Voie";document.getElementById("voie-edit-id").value="";if(currentType==="salle"){document.getElementById("voie-nom-field").classList.add("hidden");}else{document.getElementById("voie-nom-field").classList.remove("hidden");document.getElementById("voie-nom").value="";}document.getElementById("voie-niveau").value="6a";document.getElementById("voie-type").value="copyrock";document.getElementById("voie-statut").value="projet";document.getElementById("voie-essais").value="1";document.getElementById("voie-rating").value="0";document.getElementById("voie-notes").value="";updateStarDisplay(0);showView("voie-form-view");});
document.getElementById("voies-back").addEventListener('click',async()=>{await set(ref(db,"sessions/"+currentSession.id),currentSession);currentSession=null;showView("session-form-view");renderHistory();});
document.getElementById("delete-session-btn").addEventListener('click',async()=>{if(confirm("Supprimer session ?")){await remove(ref(db,"sessions/"+currentSession.id));currentSession=null;showView("session-form-view");renderHistory();}});
document.getElementById("voie-back").addEventListener('click',()=>showView("session-voies-view"));
document.getElementById("save-voie-btn").addEventListener('click',()=>{const id=document.getElementById("voie-edit-id").value;const rating=parseInt(document.getElementById("voie-rating").value);if(rating===0){alert("Note obligatoire");return;}const voie={niveau:document.getElementById("voie-niveau").value,type:document.getElementById("voie-type").value,statut:document.getElementById("voie-statut").value,essais:parseInt(document.getElementById("voie-essais").value),rating:rating,notes:document.getElementById("voie-notes").value};if(currentType==="falaise"){voie.nom=document.getElementById("voie-nom").value;if(!voie.nom){alert("Nom requis");return;}}if(id){const idx=currentSession.voies.findIndex(v=>v.id==id);currentSession.voies[idx]={...voie,id:id};}else{currentSession.voies.push({...voie,id:Date.now()});}showView("session-voies-view");renderVoies();});
if(localStorage.getItem("escalade-user")==="michel"){showView("app");document.getElementById("login-screen").classList.add("hidden");document.getElementById("home-view").classList.remove("hidden");loadData();}
});
</script>
</body>
</html>