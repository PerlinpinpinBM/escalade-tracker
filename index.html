<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Escalade">
<link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%2310b981' width='100' height='100'/%3E%3Ctext y='70' x='50' text-anchor='middle' font-size='60'%3E‚õ∞Ô∏è%3C/text%3E%3C/svg%3E">
<title>Escalade Tracker v3.0</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);color:#fff;min-height:100vh;padding:15px;-webkit-user-select:none;user-select:none;overflow-x:hidden}
.container{max-width:900px;margin:0 auto;padding-bottom:60px}
header{text-align:center;margin-bottom:25px;position:relative}
.version{position:absolute;top:0;right:0;background:#334155;padding:5px 12px;border-radius:20px;font-size:0.7rem;color:#94a3b8}
h1{font-size:2.2rem;margin-bottom:8px;display:flex;align-items:center;justify-content:center;gap:12px}
.subtitle{color:#94a3b8;font-size:0.9rem}
.nav{display:flex;gap:8px;background:#334155;padding:10px;border-radius:12px;margin-bottom:25px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.nav button{flex:1;padding:12px 15px;border:none;background:transparent;color:#fff;border-radius:8px;font-size:0.95rem;white-space:nowrap;min-width:90px;cursor:pointer;transition:all 0.3s}
.nav button.active{background:#10b981}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:15px;margin-bottom:25px}
.stat-card{background:#1e293b;padding:18px;border-radius:12px;border:1px solid #334155;text-align:center}
.stat-label{color:#94a3b8;font-size:0.8rem;margin-bottom:5px}
.stat-value{font-size:1.8rem;font-weight:bold;color:#10b981}
.card{background:#1e293b;padding:22px;border-radius:12px;border:1px solid #334155;margin-bottom:18px}
.card h2{margin-bottom:18px;display:flex;justify-content:space-between;align-items:center;font-size:1.3rem}
.btn{padding:11px 18px;border:none;border-radius:8px;font-size:0.95rem;transition:all 0.3s;cursor:pointer}
.btn-primary{background:#10b981;color:white}
.btn-primary:active{background:#059669}
.btn-secondary{background:#475569;color:white}
.btn-secondary:active{background:#334155}
.btn-danger{background:#ef4444;color:white;padding:8px 12px;font-size:0.85rem}
.btn-danger:active{background:#dc2626}
.btn-success{background:#10b981;color:white;padding:8px 12px;font-size:0.85rem}
.btn-success:active{background:#059669}
.form-grid{display:grid;grid-template-columns:1fr;gap:14px;margin-bottom:18px}
.form-group{display:flex;flex-direction:column}
.form-group label{color:#94a3b8;font-size:0.85rem;margin-bottom:5px;font-weight:500}
.form-group input,.form-group select{padding:12px;border:1px solid #475569;border-radius:8px;background:#0f172a;color:#fff;font-size:1rem;-webkit-appearance:none;appearance:none}
.form-group select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;background-size:24px;padding-right:35px}
.item{border-bottom:1px solid #334155;padding:14px 0;display:flex;justify-content:space-between;align-items:center;gap:12px}
.item:last-child{border-bottom:none}
.item-info{flex:1;min-width:0}
.item-info h3{margin-bottom:5px;font-size:1.05rem;word-wrap:break-word}
.item-details{color:#94a3b8;font-size:0.85rem;word-wrap:break-word}
.item-actions{display:flex;gap:8px;flex-shrink:0}
.empty{text-align:center;color:#94a3b8;padding:35px;font-size:0.95rem}
.hidden{display:none !important}
.badge{display:inline-block;padding:4px 10px;border-radius:6px;font-size:0.7rem;font-weight:600;margin-left:8px;white-space:nowrap}
.badge-projet{background:#fbbf24;color:#000}
.badge-r√©ussi{background:#10b981;color:#fff}
.badge-abandon{background:#ef4444;color:#fff}
.user-badge{background:#3b82f6;color:#fff;padding:3px 8px;border-radius:12px;font-size:0.7rem;margin-left:8px;white-space:nowrap}
.sync{position:fixed;bottom:20px;right:20px;background:#334155;padding:10px 14px;border-radius:10px;font-size:0.8rem;display:flex;align-items:center;gap:8px;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,0.3)}
.sync-dot{width:8px;height:8px;border-radius:50%;background:#10b981;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
@media(max-width:600px){h1{font-size:1.8rem}.card h2{font-size:1.1rem}.stat-value{font-size:1.5rem}}
</style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script type="module">
import{initializeApp as i}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import{getDatabase as g,ref as r,set as s,onValue as o,remove as d}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";const f=i({apiKey:"AIzaSyDILef-HO__QCnEJwQDNvCELmXXbF3kAfI",authDomain:"escalade-tracker.firebaseapp.com",databaseURL:"https://escalade-tracker-default-rtdb.europe-west1.firebasedatabase.app",projectId:"escalade-tracker",storageBucket:"escalade-tracker.firebasestorage.app",messagingSenderId:"355020489656",appId:"1:355020489656:web:515ba5f926045ff86f054d"}),db=g(f);window.app={v:"3.0",sessions:[],routes:[],user:localStorage.getItem("climbing-username")||"",cot:["5a","5b","5c","6a","6a+","6b","6b+","6c","6c+","7a","7a+","7b","7b+","7c","7c+","8a"],chart:null,db:db,init(){this.loadData();const e=this.user||"Bruno";document.getElementById("session-username").value=e;document.getElementById("route-username").value=e;const t=new Date().toISOString().split("T")[0];document.getElementById("session-date").value=t;document.getElementById("route-date").value=t},loadData(){document.getElementById("sync-status").textContent="Synchronisation...";o(r(this.db,"sessions"),e=>{const t=e.val();this.sessions=t?Object.values(t):[];this.updateDashboard();this.renderSessions();document.getElementById("sync-status").textContent="Synchronis√©"});o(r(this.db,"routes"),e=>{const t=e.val();this.routes=t?Object.values(t):[];this.updateDashboard();this.renderRoutes();document.getElementById("sync-status").textContent="Synchronis√©"})},async saveSession(e){try{document.getElementById("sync-status").textContent="Sauvegarde...";await s(r(this.db,"sessions/"+e.id),e);setTimeout(()=>document.getElementById("sync-status").textContent="Synchronis√©",600)}catch(e){console.error(e);document.getElementById("sync-status").textContent="‚ö†Ô∏è Erreur"}},async saveRoute(e){try{document.getElementById("sync-status").textContent="Sauvegarde...";await s(r(this.db,"routes/"+e.id),e);setTimeout(()=>document.getElementById("sync-status").textContent="Synchronis√©",600)}catch(e){console.error(e);document.getElementById("sync-status").textContent="‚ö†Ô∏è Erreur"}},showView(e){document.querySelectorAll(".nav button").forEach(e=>e.classList.remove("active"));event.target.classList.add("active");["dashboard","sessions","routes","team"].forEach(e=>{document.getElementById(e+"-view").classList.add("hidden")});document.getElementById(e+"-view").classList.remove("hidden");if(e==="team")this.renderTeamActivity()},toggleForm(e){const t=document.getElementById(e);t.classList.toggle("hidden");if(!t.classList.contains("hidden")){t.scrollIntoView({behavior:"smooth",block:"nearest"})}},async addSession(){const e=document.getElementById("session-username").value,t={id:Date.now(),username:e,date:document.getElementById("session-date").value,lieu:document.getElementById("session-lieu").value,duree:document.getElementById("session-duree").value,notes:document.getElementById("session-notes").value};if(!t.username||!t.date||!t.lieu){alert("Remplis au moins ton nom, la date et le lieu");return}if(t.username){this.user=t.username;localStorage.setItem("climbing-username",this.user)}await this.saveSession(t);document.getElementById("session-username").value=this.user;document.getElementById("session-date").value=new Date().toISOString().split("T")[0];document.getElementById("session-lieu").value="";document.getElementById("session-duree").value="";document.getElementById("session-notes").value="";this.toggleForm("session-form")},async deleteSession(e){if(confirm("Supprimer cette session ?")){try{await d(r(this.db,"sessions/"+e))}catch(e){console.error(e)}}},async addRoute(){const e=document.getElementById("route-username").value,t={id:Date.now(),username:e,nom:document.getElementById("route-nom").value,cotation:document.getElementById("route-cotation").value,categorie:document.getElementById("route-categorie").value,type:document.getElementById("route-type").value,statut:document.getElementById("route-statut").value,essais:parseInt(document.getElementById("route-essais").value),date:document.getElementById("route-date").value,notes:document.getElementById("route-notes").value};if(!t.username||!t.nom||!t.date){alert("Remplis au moins ton nom, le nom de la voie et la date");return}if(t.username){this.user=t.username;localStorage.setItem("climbing-username",this.user)}await this.saveRoute(t);document.getElementById("route-username").value=this.user;document.getElementById("route-nom").value="";document.getElementById("route-cotation").value="6a";document.getElementById("route-categorie").value="salle";document.getElementById("route-type").value="copyrock";document.getElementById("route-statut").value="projet";document.getElementById("route-essais").value="1";document.getElementById("route-date").value=new Date().toISOString().split("T")[0];document.getElementById("route-notes").value="";this.toggleForm("route-form")},async deleteRoute(e){if(confirm("Supprimer cette voie ?")){try{await d(r(this.db,"routes/"+e))}catch(e){console.error(e)}}},async updateRouteStatus(e,t){const a=this.routes.find(t=>t.id===e);if(a){a.statut=t;await this.saveRoute(a)}},renderSessions(){const e=document.getElementById("sessions-list");if(this.sessions.length===0){e.innerHTML='<div class="empty">Aucune session enregistr√©e</div>';return}e.innerHTML=this.sessions.slice().reverse().map(e=>{const t=e.username?'<span class="user-badge">'+e.username+"</span>":"",a=e.notes?" ‚Ä¢ "+e.notes:"";return'<div class="item"><div class="item-info"><h3>'+e.lieu+" "+t+'</h3><div class="item-details">'+e.date+" ‚Ä¢ "+e.duree+a+'</div></div><div class="item-actions"><button class="btn btn-danger" onclick="app.deleteSession('+e.id+')">üóë</button></div></div>'}).join("")},renderRoutes(){const e=document.getElementById("routes-list");if(this.routes.length===0){e.innerHTML='<div class="empty">Aucune voie enregistr√©e</div>';return}e.innerHTML=this.routes.slice().reverse().map(e=>{const t=e.username?'<span class="user-badge">'+e.username+"</span>":"",a=e.notes?" ‚Ä¢ "+e.notes:"",n=e.categorie?" ‚Ä¢ "+e.categorie:"",s=e.statut==="projet"?'<button class="btn btn-success" onclick="app.updateRouteStatus('+e.id+",'r√©ussi')\">‚úì</button>":"";return'<div class="item"><div class="item-info"><h3>'+e.nom+' <span class="badge badge-'+e.statut+'">'+e.statut+"</span> "+t+'</h3><div class="item-details">'+e.cotation+n+" ‚Ä¢ "+e.type+" ‚Ä¢ "+e.essais+" essai(s) ‚Ä¢ "+e.date+a+'</div></div><div class="item-actions">'+s+'<button class="btn btn-danger" onclick="app.deleteRoute('+e.id+')">üóë</button></div></div>'}).join("")},renderTeamActivity(){const e=document.getElementById("team-activity"),t=document.getElementById("team-ranking"),a=[];this.sessions.forEach(e=>a.push({type:"session",data:e,date:e.date}));this.routes.forEach(e=>a.push({type:"route",data:e,date:e.date}));a.sort((e,t)=>new Date(t.date)-new Date(e.date));const n=a.slice(0,10);if(n.length===0){e.innerHTML='<div class="empty">Aucune activit√© pour le moment</div>'}else{e.innerHTML=n.map(e=>{const t=e.data.username||"Anonyme";if(e.type==="session"){return'<div class="item"><div class="item-info"><h3>üìÖ Session - '+e.data.lieu+' <span class="user-badge">'+t+'</span></h3><div class="item-details">'+e.data.date+" ‚Ä¢ "+e.data.duree+"</div></div></div>"}else{return'<div class="item"><div class="item-info"><h3>üßó '+e.data.nom+' <span class="badge badge-'+e.data.statut+'">'+e.data.statut+'</span> <span class="user-badge">'+t+'</span></h3><div class="item-details">'+e.data.cotation+" ‚Ä¢ "+e.data.type+" ‚Ä¢ "+e.data.date+"</div></div></div>"}}).join("")}const s={};this.routes.filter(e=>e.statut==="r√©ussi").forEach(e=>{const t=e.username||"Anonyme";if(!s[t])s[t]={voies:0,sessions:0,maxCotation:""};s[t].voies++;if(!s[t].maxCotation||this.cot.indexOf(e.cotation)>this.cot.indexOf(s[t].maxCotation)){s[t].maxCotation=e.cotation}});this.sessions.forEach(e=>{const t=e.username||"Anonyme";if(!s[t])s[t]={voies:0,sessions:0,maxCotation:"-"};s[t].sessions++});const i=Object.entries(s).sort((e,t)=>t[1].voies-e[1].voies);if(i.length===0){t.innerHTML='<div class="empty">Aucune donn√©e pour le classement</div>'}else{t.innerHTML=i.map((e,t)=>{return'<div class="item"><div class="item-info"><h3>'+(t+1)+". "+e[0]+'</h3><div class="item-details">'+e[1].voies+" voies r√©ussies ‚Ä¢ "+e[1].sessions+" sessions ‚Ä¢ Max: "+e[1].maxCotation+"</div></div></div>"}).join("")}},updateDashboard(){const e=this.routes.filter(e=>e.statut==="r√©ussi"),t=e.length>0?e.map(e=>e.cotation).sort((e,t)=>this.cot.indexOf(t)-this.cot.indexOf(e))[0]:"-";document.getElementById("total-sessions").textContent=this.sessions.length;document.getElementById("total-routes").textContent=e.length;document.getElementById("best-grade").textContent=t;this.updateChart();const a=document.getElementById("recent-sessions");if(this.sessions.length===0){a.innerHTML='<div class="empty">Aucune session enregistr√©e</div>'}else{a.innerHTML=this.sessions.slice(-3).reverse().map(e=>{const t=e.username?'<span class="user-badge">'+e.username+"</span>":"";return'<div class="item"><div class="item-info"><h3>'+e.lieu+" "+t+'</h3><div class="item-details">'+e.date+" ‚Ä¢ "+e.duree+"</div></div></div>"}).join("")}const n=document.getElementById("current-projects"),s=this.routes.filter(e=>e.statut==="projet");if(s.length===0){n.innerHTML='<div class="empty">Aucun projet en cours</div>'}else{n.innerHTML=s.map(e=>{const t=e.username?'<span class="user-badge">'+e.username+"</span>":"";return'<div class="item"><div class="item-info"><h3>'+e.nom+" "+t+'</h3><div class="item-details">'+e.cotation+" ‚Ä¢ "+e.type+" ‚Ä¢ "+e.essais+" essai(s)</div></div><div class=\"item-actions\"><button class=\"btn btn-success\" onclick=\"app.updateRouteStatus("+e.id+",'r√©ussi')\">‚úì R√©ussi</button></div></div>"}).join("")}},updateChart(){const e=document.getElementById("yearChart");if(!e)return;const t=new Date().getFullYear(),a=["Jan","F√©v","Mar","Avr","Mai","Jun","Jul","Ao√ª","Sep","Oct","Nov","D√©c"],n=new Array(12).fill(0),s=new Array(12).fill(0),i=new Array(12).fill(null),o=new Array(12).fill(null);this.routes.filter(e=>e.statut==="r√©ussi"&&new Date(e.date).getFullYear()===t).forEach(e=>{const t=new Date(e.date).getMonth(),a=this.cot.indexOf(e.cotation);if(e.username==="Bruno"){n[t]++;if(i[t]===null||a>i[t]){i[t]=a}}else if(e.username==="Sophie"){s[t]++;if(o[t]===null||a>o[t]){o[t]=a}}});if(this.chart)this.chart.destroy();this.chart=new Chart(e,{type:"bar",data:{labels:a,datasets:[{label:"Bruno (voies)",data:n,backgroundColor:"rgba(59,130,246,0.8)",borderColor:"rgb(59,130,246)",borderWidth:1,yAxisID:"y"},{label:"Sophie (voies)",data:s,backgroundColor:"rgba(236,72,153,0.8)",borderColor:"rgb(236,72,153)",borderWidth:1,yAxisID:"y"},{label:"Bruno (niveau max)",data:i,type:"line",borderColor:"rgb(59,130,246)",backgroundColor:"transparent",borderWidth:2,yAxisID:"y1",pointRadius:4},{label:"Sophie (niveau max)",data:o,type:"line",borderColor:"rgb(236,72,153)",backgroundColor:"transparent",borderWidth:2,yAxisID:"y1",pointRadius:4}]},options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{labels:{color:"#fff",font:{size:10}}},title:{display:false},tooltip:{callbacks:{label:function(e){if(e.dataset.type==="line"){const t=Math.round(e.parsed.y);return e.dataset.label+": "+app.cot[t]}return e.dataset.label+": "+e.parsed.y}}}},scales:{y:{beginAtZero:true,position:"left",ticks:{color:"#94a3b8",stepSize:1},grid:{color:"#334155"},title:{display:true,text:"Nombre de voies",color:"#94a3b8"}},y1:{position:"right",min:0,max:app.cot.length-1,ticks:{color:"#94a3b8",callback:function(e){return app.cot[Math.round(e)]||""}},grid:{display:false},title:{display:true,text:"Niveau max",color:"#94a3b8"}},x:{ticks:{color:"#94a3b8"},grid:{display:false}}}}})}};window.app.init();
</script>
<div class="container">
<header>
<div class="version">v3.0 Firebase</div>
<h1><span>‚õ∞Ô∏è</span>Escalade Tracker</h1>
<p class="subtitle">Suis ta progression et grimpe plus haut !</p>
</header>
<div class="nav">
<button class="active" onclick="app.showView('dashboard')">üìä Accueil</button>
<button onclick="app.showView('sessions')">üìÖ Sessions</button>
<button onclick="app.showView('routes')">üìà Voies</button>
<button onclick="app.showView('team')">üë• √âquipe</button>
</div>
<div id="dashboard-view">
<div class="stats">
<div class="stat-card"><div class="stat-label">Sessions</div><div class="stat-value" id="total-sessions">0</div></div>
<div class="stat-card"><div class="stat-label">R√©ussies</div><div class="stat-value" id="total-routes">0</div></div>
<div class="stat-card"><div class="stat-label">Max</div><div class="stat-value" id="best-grade">-</div></div>
</div>
<div class="card"><h2>Progression de l'ann√©e</h2><canvas id="yearChart" style="max-height:250px"></canvas></div>
<div class="card"><h2>Derni√®res sessions</h2><div id="recent-sessions"></div></div>
<div class="card"><h2>Projets en cours</h2><div id="current-projects"></div></div>
</div>
<div id="sessions-view" class="hidden">
<div class="card">
<h2>Sessions<button class="btn btn-primary" onclick="app.toggleForm('session-form')">‚ûï Ajouter</button></h2>
<div id="session-form" class="hidden" style="margin-bottom:18px">
<div class="form-grid">
<div class="form-group"><label>Ton nom</label><select id="session-username"><option value="">S√©lectionne</option><option value="Bruno">Bruno</option><option value="Sophie">Sophie</option></select></div>
<div class="form-group"><label>Date</label><input type="date" id="session-date"></div>
<div class="form-group"><label>Lieu</label><input type="text" id="session-lieu" placeholder="Salle d'escalade"></div>
<div class="form-group"><label>Dur√©e</label><input type="text" id="session-duree" placeholder="Ex: 2h30"></div>
<div class="form-group"><label>Notes</label><input type="text" id="session-notes" placeholder="Optionnel"></div>
</div>
<div style="display:flex;gap:10px">
<button class="btn btn-primary" onclick="app.addSession()">‚úì Enregistrer</button>
<button class="btn btn-secondary" onclick="app.toggleForm('session-form')">‚úï Annuler</button>
</div>
</div>
<div id="sessions-list"></div>
</div>
</div>
<div id="routes-view" class="hidden">
<div class="card">
<h2>Voies<button class="btn btn-primary" onclick="app.toggleForm('route-form')">‚ûï Ajouter</button></h2>
<div id="route-form" class="hidden" style="margin-bottom:18px">
<div class="form-grid">
<div class="form-group"><label>Ton nom</label><select id="route-username"><option value="">S√©lectionne</option><option value="Bruno">Bruno</option><option value="Sophie">Sophie</option></select></div>
<div class="form-group"><label>Nom de la voie</label><input type="text" id="route-nom" placeholder="Ex: La Directe"></div>
<div class="form-group"><label>Cotation</label><select id="route-cotation"><option>5a</option><option>5b</option><option>5c</option><option selected>6a</option><option>6a+</option><option>6b</option><option>6b+</option><option>6c</option><option>6c+</option><option>7a</option><option>7a+</option><option>7b</option><option>7b+</option><option>7c</option><option>7c+</option><option>8a</option></select></div>
<div class="form-group"><label>Cat√©gorie</label><select id="route-categorie"><option value="salle" selected>Salle</option><option value="falaise">Falaise</option></select></div>
<div class="form-group"><label>Type</label><select id="route-type"><option value="copyrock">CopyRock</option><option value="dalle">Dalle</option><option value="devers">Devers</option><option value="gros-devers">Gros Devers</option><option value="petit-devers">Petit Devers</option><option value="vertical">Vertical</option></select></div>
<div class="form-group"><label>Statut</label><select id="route-statut"><option value="projet">Projet</option><option value="r√©ussi">R√©ussi</option><option value="abandon">Abandon</option></select></div>
<div class="form-group"><label>Essais</label><input type="number" id="route-essais" value="1" min="1"></div>
<div class="form-group"><label>Date</label><input type="date" id="route-date"></div>
<div class="form-group"><label>Notes</label><input type="text" id="route-notes" placeholder="Optionnel"></div>
</div>
<div style="display:flex;gap:10px">
<button class="btn btn-primary" onclick="app.addRoute()">‚úì Enregistrer</button>
<button class="btn btn-secondary" onclick="app.toggleForm('route-form')">‚úï Annuler</button>
</div>
</div>
<div id="routes-list"></div>
</div>
</div>
<div id="team-view" class="hidden">
<div class="card"><h2>Activit√© r√©cente</h2><div id="team-activity"></div></div>
<div class="card"><h2>Classement</h2><div id="team-ranking"></div></div>
</div>
</div>
<div class="sync"><div class="sync-dot"></div><span id="sync-status">Synchronis√©</span></div>
</body>
</html>
